@page
@model ASIGNAR_SubscriptionSystem.Pages.DatabaseUnavailableModel
@{
    ViewData["Title"] = "Database Unavailable";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

<div class="container d-flex align-items-center justify-content-center" style="min-height: 70vh;">
    <div class="text-center">
        <div class="mb-4">
            <i class="bi bi-database-x display-1 text-danger"></i>
        </div>
        <h1 class="display-5 mb-3">Database Unavailable</h1>
        <p class="lead text-muted mb-4">
            We're unable to connect to the database at this time.<br/>
            Please try again in a moment.
        </p>
        
        @if (!string.IsNullOrEmpty(Model.ErrorDetails))
        {
            <div class="alert alert-warning mx-auto mb-4" style="max-width: 600px;" role="alert">
                <i class="bi bi-info-circle me-2"></i>
                @Model.ErrorDetails
            </div>
        }

        <div class="d-flex gap-3 justify-content-center">
            <form method="post" asp-page-handler="RetryConnection">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-arrow-clockwise me-2"></i>
                    Retry Connection
                </button>
            </form>
            <a href="/" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-house me-2"></i>
                Go to Home
            </a>
        </div>

        @if (Model.ShowTechnicalDetails && !string.IsNullOrEmpty(Model.TechnicalMessage))
        {
            <div class="mt-5">
                <details class="text-start mx-auto" style="max-width: 800px;">
                    <summary class="btn btn-link text-muted">Technical Details</summary>
                    <div class="alert alert-secondary mt-3">
                        <small class="font-monospace">@Model.TechnicalMessage</small>
                    </div>
                </details>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        // Auto-retry after 10 seconds if enabled
        @if (Model.EnableAutoRetry)
        {
            @:let countdown = 10;
            @:const countdownElement = document.createElement('p');
            @:countdownElement.className = 'text-muted mt-3';
            @:countdownElement.innerHTML = '<small>Auto-retrying in <span id="countdown">' + countdown + '</span> seconds...</small>';
            @:document.querySelector('.container').appendChild(countdownElement);
            @:
            @:const timer = setInterval(function() {
            @:    countdown--;
            @:    document.getElementById('countdown').textContent = countdown;
            @:    if (countdown <= 0) {
            @:        clearInterval(timer);
            @:        document.querySelector('form button').click();
            @:    }
            @:}, 1000);
        }
    </script>
}
